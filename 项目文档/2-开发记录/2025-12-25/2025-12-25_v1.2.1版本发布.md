# v1.2.1 版本发布记录

**发布日期**: 2025-12-25  
**版本号**: 1.2.1  
**发布类型**: Bug修复版本

---

## 📋 版本概述

v1.2.1 是一个快速 bug 修复版本，主要解决了 v1.2.0 中发现的两个关键问题。

---

## 🐛 修复的 Bug

### 1. 就地输出模式要求选择目标目录

**问题描述**：
- 选择"就地输出到源文件目录"模式后
- 点击"开始转换"按钮
- 系统仍然提示"请先选择目标目录"
- 导致就地输出模式无法正常使用

**原因分析**：
- `_start_conversion()` 函数中无条件检查 `target_dir`
- 未区分"集中输出"和"就地输出"两种模式
- 就地输出模式实际上不需要目标目录

**解决方案**：
```python
def _start_conversion(self):
    """开始转换"""
    # 集中输出模式需要目标目录，就地输出模式不需要
    if self.output_mode == "centralized":
        if not self.target_dir:
            messagebox.showwarning("警告", "请先选择目标目录")
            return
        self.target_dir.mkdir(parents=True, exist_ok=True)
        if not self.conversion_state:
            self.conversion_state = ConversionState(self.target_dir / ".conversion_state.json")
```

**修改文件**：
- `project-code/app.py` (行 737-756)

---

### 2. 默认覆盖模式未生效

**问题描述**：
- 用户需求：重新转换时默认覆盖已有文件
- 实际情况："覆盖已有文件"复选框默认未选中
- 导致每次都需要手动勾选

**原因分析**：
- 初始化时 `self.overwrite_mode = False`
- UI 复选框 `self.overwrite_var = ctk.BooleanVar(value=False)`

**解决方案**：
1. 修改变量初始化：`self.overwrite_mode = True`
2. 修改 UI 复选框：`self.overwrite_var = ctk.BooleanVar(value=True)`

**修改文件**：
- `project-code/app.py` (行 188, 306)

---

## 📦 打包信息

### 构建信息
- **打包工具**: PyInstaller 6.17.0
- **Python 版本**: 3.13.5
- **构建平台**: Windows 10 64位
- **文件大小**: 58.3 MB

### 打包文件位置
- 可执行文件：`project-code/dist/PDF-MD-TOOLS.exe`
- 发布包：`project-code/release/PDF-MD-TOOLS_v1.2.1.exe`

---

## 🚀 发布流程

### 1. 代码提交
```bash
git add .
git commit -m "v1.2.1: 修复就地输出模式bug和默认覆盖模式问题"
git push origin main
```

**提交哈希**: `eba1448`

### 2. 创建标签
```bash
git tag -a v1.2.1 -m "v1.2.1: Bug修复版本 - 修复就地输出模式和默认覆盖模式"
git push origin v1.2.1
```

### 3. 创建 GitHub Release
```bash
gh release create v1.2.1 \
  --title "v1.2.1 Bug修复版本" \
  --notes-file RELEASE_NOTES_v1.2.1.md \
  "project-code/release/PDF-MD-TOOLS_v1.2.1.exe"
```

**Release URL**: https://github.com/hhtbing-wisefido/PDF-MD-TOOLS/releases/tag/v1.2.1

---

## ✅ 测试验证

### 测试项 1：就地输出模式
- [x] 选择"就地输出到源文件目录"
- [x] 选择源 PDF 目录
- [x] 点击"扫描PDF"
- [x] 点击"开始转换"（无需选择目标目录）
- [x] 验证：文件正确输出到 PDF 所在目录

### 测试项 2：默认覆盖模式
- [x] 启动程序
- [x] 验证："覆盖已有文件"复选框默认选中
- [x] 进行转换
- [x] 验证：已有文件被正确覆盖

---

## 📊 版本对比

| 功能 | v1.2.0 | v1.2.1 |
|------|--------|--------|
| 集中输出模式 | ✅ 正常 | ✅ 正常 |
| 就地输出模式 | ❌ 无法使用 | ✅ 已修复 |
| 默认覆盖模式 | ❌ 未开启 | ✅ 已修复 |
| 图片提取 | ✅ 正常 | ✅ 正常 |
| 输出模式切换 | ✅ 正常 | ✅ 正常 |

---

## 📝 文件清单

### 修改的文件
1. `project-code/app.py` - 主程序
   - 更新版本号到 1.2.1
   - 修复就地输出模式检查逻辑
   - 修改默认覆盖模式为 True

2. `project-code/build_exe.py` - 打包脚本
   - 更新版本号到 1.2.1

### 新增的文件
1. `RELEASE_NOTES_v1.2.1.md` - 发布说明
2. `项目文档/2-开发记录/2025-12-25/2025-12-25_v1.2.1版本发布.md` - 本文档

---

## 🎯 后续计划

### 短期计划
- 监控用户反馈
- 收集新功能需求
- 优化用户体验

### 长期计划
- 支持更多输出格式
- 优化 PDF 解析算法
- 添加批量处理功能

---

## 📞 支持与反馈

- **GitHub Issues**: https://github.com/hhtbing-wisefido/PDF-MD-TOOLS/issues
- **项目主页**: https://github.com/hhtbing-wisefido/PDF-MD-TOOLS

---

**发布人员**: AI Assistant  
**发布时间**: 2025-12-25 14:30 (UTC+8)
