# v1.2.0 版本发布记录

**发布日期**: 2025-12-25  
**版本**: 1.2.0  
**发布人**: 开发团队

---

## 📋 版本信息

- **版本号**: v1.2.0
- **上一版本**: v1.1.4
- **发布类型**: 功能更新
- **构建日期**: 2025-12-25

---

## ✨ 主要更新

### 1. 新增就地输出模式

**功能描述**：
- 支持将转换后的 MD 文件和图片直接保存到源 PDF 所在目录
- 每个 PDF 生成对应的独立图片目录（`文件名_images/`）
- 保持源文件目录结构，便于文件管理

**适用场景**：
- 需要保持 PDF 和 MD 文件在同一位置
- 源目录有良好的组织结构
- 不需要集中管理输出文件

**实现细节**：
- 修改 `app.py` 添加输出模式选择 UI
- 修改 `extractor.py` 支持自定义图片子目录
- 修改 `converter.py` 支持动态图片路径引用
- 添加目录权限检查机制

### 2. 界面优化

**UI 改进**：
- 新增大而明显的蓝色输出模式选择框
- 单选按钮样式优化（22x22像素，高对比度）
- 模式切换时自动启用/禁用相关控件
- 实时日志反馈模式切换状态

**用户体验**：
- 选择就地输出时，目标目录选择自动禁用（灰色显示）
- 清晰的视觉反馈和状态提示
- 更直观的操作流程

### 3. 智能错误处理

**权限检查**：
- 转换前自动检测输出目录写入权限
- 只读目录弹窗提示，引导用户选择正确模式
- 友好的错误消息，提供解决方案

**覆盖模式改进**：
- 重新转换时，默认选中覆盖已有文件
- 避免重复生成 `_1`, `_2` 后缀文件
- 保持文件名清洁

---

## 🔧 技术实现

### 代码变更

#### app.py
```python
# 新增输出模式变量
self.output_mode = "centralized"  # 或 "inplace"

# 新增模式切换处理
def _on_output_mode_changed(self):
    if self.output_mode == "inplace":
        # 禁用目标目录选择
        self.target_entry.configure(state="disabled")
    else:
        # 启用目标目录选择
        self.target_entry.configure(state="normal")

# 转换逻辑适配
def _convert_single_pdf(self, file_item, idx):
    if self.output_mode == "inplace":
        output_dir = file_item.pdf_path.parent
        images_dir = output_dir / f"{file_item.pdf_path.stem}_images"
    else:
        output_dir = self.target_dir
        images_dir = self.target_dir / "images"
```

#### extractor.py
```python
# 支持自定义图片子目录
def extract_pdf_content(
    pdf_path: Path,
    output_dir: Path,
    images_subdir: str = "images",  # 新增参数
    extract_images: bool = True,
    image_dpi: int = 150
) -> PDFContent:
    images_dir = output_dir / images_subdir
    images_dir.mkdir(parents=True, exist_ok=True)
    # ...
```

### 测试验证

- ✅ 集中输出模式测试通过
- ✅ 就地输出模式测试通过
- ✅ 模式切换测试通过
- ✅ 权限检查测试通过
- ✅ 覆盖模式测试通过

---

## 📦 构建信息

- **打包工具**: PyInstaller 6.17.0
- **Python版本**: 3.13.5
- **文件大小**: 58.3 MB
- **支持系统**: Windows 10/11 (64位)
- **输出文件**: `PDF-MD-TOOLS_v1.2.0.exe`

---

## 📊 性能对比

| 指标 | v1.1.4 | v1.2.0 | 变化 |
|------|--------|--------|------|
| 启动时间 | ~2s | ~2s | 无变化 |
| 转换速度 | 10 PDF/min | 10 PDF/min | 无变化 |
| 内存占用 | ~200MB | ~200MB | 无变化 |
| 文件大小 | 58.3MB | 58.3MB | 无变化 |
| 输出模式 | 1种 | 2种 | ✨ 新增 |

---

## 🐛 Bug 修复

无重大 Bug 修复，本版本主要为功能增强。

---

## ⚠️ 已知限制

1. **就地输出模式限制**：
   - 要求源目录可写
   - 只读目录需使用集中输出模式

2. **兼容性**：
   - 仅支持 Windows 10/11 64位
   - 需要管理员权限处理受保护目录

---

## 🚀 发布检查清单

- [x] 代码实现完成
- [x] 功能测试通过
- [x] UI 测试通过
- [x] 权限检查测试
- [x] 版本号更新（1.2.0）
- [x] 构建日期更新（2025-12-25）
- [x] EXE 打包成功
- [x] 发布说明编写
- [x] README 更新
- [x] 项目文档更新
- [ ] GitHub Release 发布
- [ ] 发布公告

---

## 📝 后续计划

### v1.3.0 计划功能
- [ ] 支持 PDF 批量重命名
- [ ] 添加转换预览功能
- [ ] 支持自定义 Markdown 格式模板
- [ ] 添加转换历史记录
- [ ] 支持多语言界面

---

## 🙏 致谢

感谢所有用户的反馈和建议，特别感谢提出"就地输出"需求的用户！

---

**发布状态**: ✅ 已完成  
**下一步**: 发布到 GitHub Release
